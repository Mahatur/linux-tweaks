#!/bin/bash

# Find hwmon paths by name (stable across reboots)
CPU_TEMP_PATH=$(grep -l "coretemp" /sys/class/hwmon/*/name | xargs dirname)/temp1_input
CPU_FAN_PATH=$(grep -l "it8728" /sys/class/hwmon/*/name | xargs dirname)/pwm3
CPU_FAN_ENABLE=$(grep -l "it8728" /sys/class/hwmon/*/name | xargs dirname)/pwm3_enable

# Enable manual control
echo 1 > $CPU_FAN_ENABLE

# Function to calculate PWM duty cycle (linear mapping)
calculate_pwm() {
    local TEMP=$1
    local MIN_TEMP=$2
    local MAX_TEMP=$3
    local MIN_PWM=0
    local MAX_PWM=255

    if (( TEMP <= MIN_TEMP )); then
        echo $MIN_PWM
        return
    fi

    if (( TEMP >= MAX_TEMP )); then
        echo $MAX_PWM
        return
    fi

    echo $(( (TEMP - MIN_TEMP) * (MAX_PWM - MIN_PWM) / (MAX_TEMP - MIN_TEMP) + MIN_PWM ))
}

while true; do
    # Read CPU temp (°C)
    CPU_TEMP=$(( $(cat $CPU_TEMP_PATH) / 1000 ))

    # Map 40°C → 0% and 95°C → 100%
    CPU_PWM=$(calculate_pwm $CPU_TEMP 40 95)

    # Apply new fan speed
    echo $CPU_PWM > $CPU_FAN_PATH

    # Debug info
    echo "CPU: ${CPU_TEMP}°C → PWM: $CPU_PWM"

    sleep 5
done



with gpu


#!/bin/bash

# Find hwmon paths by name (stable across reboots)
CPU_TEMP_PATH=$(grep -l "coretemp" /sys/class/hwmon/*/name | xargs dirname)/temp1_input
CPU_FAN_BASE=$(grep -l "nct6779" /sys/class/hwmon/*/name | xargs dirname)

CPU_FAN_PATH="$CPU_FAN_BASE/pwm1"
CPU_FAN_ENABLE="$CPU_FAN_BASE/pwm1_enable"

GPU_BASE=$(grep -l "radeon" /sys/class/hwmon/*/name | xargs dirname)
GPU_TEMP_PATH="$GPU_BASE/temp1_input"
GPU_FAN_PATH="$GPU_BASE/pwm1"
GPU_FAN_ENABLE="$GPU_BASE/pwm1_enable"

# Enable manual control
echo 1 > $CPU_FAN_ENABLE
echo 1 > $GPU_FAN_ENABLE

# Function to calculate PWM duty cycle (linear mapping)
calculate_pwm() {
    local TEMP=$1
    local MIN_TEMP=$2
    local MAX_TEMP=$3
    local MIN_PWM=0
    local MAX_PWM=255

    if (( TEMP <= MIN_TEMP )); then
        echo $MIN_PWM
        return
    fi
    if (( TEMP >= MAX_TEMP )); then
        echo $MAX_PWM
        return
    fi

    echo $(( (TEMP - MIN_TEMP) * (MAX_PWM - MIN_PWM) / (MAX_TEMP - MIN_TEMP) + MIN_PWM ))
}

while true; do
    CPU_TEMP=$(( $(cat $CPU_TEMP_PATH) / 1000 ))
    GPU_TEMP=$(( $(cat $GPU_TEMP_PATH) / 1000 ))

    CPU_PWM=$(calculate_pwm $CPU_TEMP 40 95)
    GPU_PWM=$(calculate_pwm $GPU_TEMP 40 85)

    echo $CPU_PWM > $CPU_FAN_PATH
    echo $GPU_PWM > $GPU_FAN_PATH

    echo "CPU: ${CPU_TEMP}°C → CPU PWM $CPU_PWM"
    echo "GPU: ${GPU_TEMP}°C → GPU PWM $GPU_PWM"

    sleep 5
done

